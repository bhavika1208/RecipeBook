{"ast":null,"code":"import { BehaviorSubject, throwError } from \"rxjs\";\nimport { catchError, tap } from \"rxjs/operators\";\nimport { User } from \"./user.model\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.user = new BehaviorSubject(null);\n    this.token = null;\n  }\n  signup(email, password) {\n    return this.http.post('https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA', {\n      email: email,\n      password: password,\n      returnSecureToken: true\n    }).pipe(catchError(this.handleError), tap(resData => {\n      this.handleAuthentication(resData.email, resData.localId, resData.idToken, +resData.expiresIn);\n    }));\n  }\n  logout() {\n    this.user.next(null);\n    this.router.navigate(['/auth']);\n    localStorage.removeItem('userData');\n    if (this.tokenExpirationTimer) {\n      clearTimeout(this.tokenExpirationTimer);\n    }\n  }\n  autoLogout(expirationDuration) {\n    this.tokenExpirationTimer = setTimeout(() => {\n      this.logout();\n    }, expirationDuration);\n  }\n  login(email, password) {\n    return this.http.post('https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA', {\n      email: email,\n      password: password,\n      returnSecureToken: true\n    }).pipe(catchError(this.handleError), tap(resData => {\n      this.handleAuthentication(resData.email, resData.localId, resData.idToken, +resData.expiresIn);\n    }));\n  }\n  autoLogin() {\n    const userData = JSON.parse(localStorage.getItem('userData'));\n    if (!userData) {\n      return;\n    }\n    const loadedData = new User(userData.email, userData.id, userData._token, new Date(userData._tokenExpirationDate));\n    if (loadedData.token) {\n      this.user.next(loadedData);\n      const expirationDuration = new Date(userData._tokenExpirationDate).getTime() - new Date().getTime();\n      this.autoLogout(expirationDuration);\n    }\n  }\n  handleAuthentication(email, userId, token, expiresIn) {\n    const exierationDate = new Date(new Date().getTime() + expiresIn * 1000);\n    const user = new User(email, userId, token, exierationDate);\n    this.user.next(user);\n    this.autoLogout(expiresIn * 1000);\n    localStorage.setItem('userData', JSON.stringify(user));\n  }\n  handleError(errorRes) {\n    let errorMsg = 'An unknown error ocurred!!';\n    if (!errorRes.error || !errorRes.error.error) {\n      console.log('gg');\n      return throwError(errorRes);\n    }\n    switch (errorRes.error.error.message) {\n      case 'EMAIL_EXISTS':\n        errorMsg = 'email already exist!!';\n        break;\n      case 'INVALID_PASSWORD':\n        errorMsg = 'email already exist!!';\n        break;\n      case 'EMAIL_NOT_FOUND':\n        errorMsg = 'email already exist!!';\n        break;\n    }\n    return throwError(errorMsg);\n  }\n}\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n};\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["BehaviorSubject","throwError","catchError","tap","User","AuthService","constructor","http","router","signup","email","password","post","returnSecureToken","pipe","handleError","resData","handleAuthentication","localId","idToken","expiresIn","logout","user","next","navigate","localStorage","removeItem","tokenExpirationTimer","clearTimeout","autoLogout","expirationDuration","setTimeout","login","autoLogin","userData","JSON","parse","getItem","loadedData","id","_token","Date","_tokenExpirationDate","token","getTime","userId","exierationDate","setItem","stringify","errorRes","errorMsg","error","console","log","message","factory","providedIn"],"sourceRoot":"","sources":["E:\\DOCUMENTS\\Internship\\Angular\\Project\\src\\app\\auth\\auth.service.ts"],"sourcesContent":["// import { HttpClient, HttpErrorResponse } from \"@angular/common/http\";\r\n// import { Injectable } from \"@angular/core\";\r\n// import { catchError, tap } from \"rxjs/operators\";\r\n// import { BehaviorSubject, throwError } from \"rxjs\";\r\n// import { User } from \"./user.model\";\r\n// import { Route, Router } from \"@angular/router\";\r\n\r\n// export interface AuthResponseData {\r\n//     kind: string;\r\n//     idToken: string;\r\n//     email: string;\r\n//     refreshToken: string;\r\n//     expiresIn: string;\r\n//     localId: string;\r\n//     registered?: boolean;\r\n// }\r\n\r\n\r\n// @Injectable({ \r\n//     providedIn: 'root' \r\n// })\r\n// export class AuthService{\r\n\r\n//     user = new BehaviorSubject<User>(null);\r\n//     token: string = null;\r\n//     private tokenExpirationTime: any;\r\n    \r\n//     constructor(private http: HttpClient, private router: Router){\r\n//     }\r\n\r\n\r\n//     signup(email: string, password: string ){\r\n//         return this.http.post<AuthResponseData>(\r\n//             'https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\r\n//         {\r\n//             email: email,\r\n//             password: password,\r\n//             returnSecuredToken: true\r\n\r\n//         }).pipe(catchError(this.handlError), \r\n//             tap(resData => {\r\n//             this.handleAuthentication(\r\n//                 resData.email, \r\n//                 resData.localId, \r\n//                 resData.idToken, \r\n//                 +resData.expiresIn\r\n//             )\r\n//         }));\r\n//     }\r\n\r\n//     login(email: string, password: string){\r\n//         return this.http.post<AuthResponseData>(\r\n//             'https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\r\n//             {\r\n//                 email: email,\r\n//                 password: password,\r\n//                 returnSecuredToken: true\r\n//             }).pipe(catchError(this.handlError), tap(resData => {            \r\n//                 this.handleAuthentication(resData.email, resData.localId, resData.idToken, +resData.expiresIn)\r\n//             }));\r\n//     }\r\n\r\n//     autoLogin(){\r\n//         const userData: {\r\n//             email : string;\r\n//             id: string;\r\n//             _token : string;\r\n//             _tokenExpirationDate : string;\r\n//         } = JSON.parse(localStorage.getItem('userData'));\r\n//         if(!userData){\r\n//             return;\r\n//         }\r\n\r\n//         const loadedUser = new User(\r\n//             userData.email, \r\n//             userData.id, \r\n//             userData._token,\r\n//             new Date(userData._tokenExpirationDate)\r\n//         );\r\n    \r\n//         if(loadedUser.token){\r\n//             this.user.next(loadedUser);\r\n//             const expirationDate = new Date(userData._tokenExpirationDate).getTime() - new Date().getTime();\r\n//             this.autoLogout(expirationDate);\r\n//             console.log(expirationDate);\r\n//         }\r\n//     }\r\n\r\n//     logout(){\r\n//         this.user.next(null);\r\n//         this.router.navigate(['./auth']);\r\n//         localStorage.removeItem('userData');\r\n//         if(this.tokenExpirationTime){\r\n//             clearTimeout(this.tokenExpirationTime);\r\n//         }\r\n//         this.tokenExpirationTime = null;\r\n//     }\r\n\r\n//     autoLogout(expirationDuration: number){\r\n//         console.log(expirationDuration);\r\n      \r\n//         setTimeout(()=>{   \r\n//             this.logout();\r\n//         }, 7000000);\r\n//     }\r\n\r\n//     private handleAuthentication(email: string,userId: string, token: string, expiresIn: number){\r\n//         const expirationDate = new Date(new Date().getTime()+ (expiresIn*1000));\r\n//         const user = new User(email, userId, token, expirationDate)\r\n//         this.user.next(user);\r\n//         this.autoLogout(expiresIn * 1000);\r\n//         localStorage.setItem('userData', JSON.stringify(user))\r\n    \r\n//     }\r\n\r\n//     private handlError(errorRes: HttpErrorResponse){\r\n        \r\n//         let errorMsg = \"An Unknown error has been occured\"\r\n//         console.log(errorRes.error.error);\r\n        \r\n//         // errorRes.error && errorRes.error.error\r\n//         if(!errorRes.error || !errorRes.error.error){\r\n//             return throwError(errorMsg);\r\n//         }\r\n        \r\n//         switch( errorRes.error.error.message){\r\n//             case 'EMAIL_EXISTS': errorMsg = \"An Email Exists Already\";\r\n//                                 break;\r\n//             case 'EMAIL_NOT_FOUND': errorMsg = \"This Email does not Exist\";\r\n//             break;\r\n//             case 'INVALID_PASSWORD': errorMsg = \"Password is Incorrect\";\r\n//             break;\r\n        \r\n//         }\r\n//         return throwError(errorMsg);       \r\n//     }\r\n// }\r\n\r\n\r\nimport { HttpClient, HttpErrorResponse } from \"@angular/common/http\";\r\nimport { Injectable } from \"@angular/core\";\r\nimport { Router } from \"@angular/router\";\r\nimport { BehaviorSubject, Subject, throwError } from \"rxjs\";\r\nimport { catchError, tap } from \"rxjs/operators\";\r\nimport { User } from \"./user.model\";\r\nexport interface AuthResponseData{\r\n    idToken:string,\r\n    email:string,\r\n    refreshToken:string,\r\n    expiresIn:string,\r\n    localId:string,\r\n    registered?:boolean\r\n}\r\n@Injectable({providedIn:'root'})\r\nexport class AuthService{\r\n    user=new BehaviorSubject<User>(null);\r\n\r\n    token:string=null;\r\n    tokenExpirationTimer:any;\r\n    constructor(private http:HttpClient,private router:Router){}\r\n\r\n    signup(email:string,password:string){\r\n        return this.http.post<AuthResponseData>('https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\r\n        {\r\n            email:email,\r\n            password:password,\r\n            returnSecureToken:true\r\n        }\r\n        ).pipe(catchError(this.handleError),tap(resData=>{\r\n            this.handleAuthentication(\r\n                                    resData.email,\r\n                                    resData.localId,\r\n                                    resData.idToken,\r\n                                    +resData.expiresIn)\r\n        }))\r\n        ;\r\n    }\r\n\r\n    logout(){\r\n        this.user.next(null);\r\n        this.router.navigate(['/auth']);\r\n        localStorage.removeItem('userData');\r\n        if(this.tokenExpirationTimer){\r\n            clearTimeout(this.tokenExpirationTimer);\r\n        }\r\n    }\r\n    \r\n    autoLogout(expirationDuration){\r\n        this.tokenExpirationTimer= setTimeout(()=>{\r\n            this.logout();\r\n        },expirationDuration);\r\n    }\r\n    login(email:string,password:string){\r\n        return  this.http.post<AuthResponseData>('https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\r\n        {\r\n            email:email,\r\n            password:password,\r\n            returnSecureToken:true\r\n        }  ).pipe(catchError(this.handleError),tap(resData=>{\r\n            this.handleAuthentication(\r\n                                    resData.email,\r\n                                    resData.localId,\r\n                                    resData.idToken,\r\n                                    +resData.expiresIn)\r\n        }));\r\n    }\r\n    autoLogin(){\r\n        const userData:{\r\n            email:string,\r\n            id:string,\r\n            _token:string,\r\n            _tokenExpirationDate:string\r\n        }=JSON.parse(localStorage.getItem('userData'));\r\n        if(!userData){\r\n            return;\r\n        }\r\n        const loadedData=new User(userData.email,userData.id,userData._token,new Date(userData._tokenExpirationDate));\r\n        if(loadedData.token){\r\n            this.user.next(loadedData);\r\n            const expirationDuration=new Date(userData._tokenExpirationDate).getTime() - new Date().getTime();\r\n            this.autoLogout(expirationDuration);\r\n        }\r\n    }\r\n    private handleAuthentication(\r\n        email:string,\r\n        userId:string,\r\n        token:string,\r\n        expiresIn:number\r\n        ){\r\n            const exierationDate=new Date(new Date().getTime() + expiresIn*1000);\r\n            const user= new User(\r\n                email,\r\n                userId,\r\n                token,\r\n                exierationDate);\r\n            this.user.next(user);\r\n            this.autoLogout(expiresIn*1000);\r\n            localStorage.setItem('userData',JSON.stringify(user))\r\n        }\r\n    private handleError(errorRes:HttpErrorResponse){\r\n        let errorMsg='An unknown error ocurred!!'\r\n        if (!errorRes.error || !errorRes.error.error) {\r\n            console.log('gg');\r\n            return throwError(errorRes);\r\n          }\r\n        switch(errorRes.error.error.message){\r\n            case 'EMAIL_EXISTS':\r\n                errorMsg='email already exist!!';\r\n                break;\r\n            case 'INVALID_PASSWORD':\r\n                errorMsg='email already exist!!';\r\n                break;\r\n            case 'EMAIL_NOT_FOUND':\r\n                errorMsg='email already exist!!';\r\n                break;\r\n        }\r\n        return throwError(errorMsg);\r\n    }\r\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}