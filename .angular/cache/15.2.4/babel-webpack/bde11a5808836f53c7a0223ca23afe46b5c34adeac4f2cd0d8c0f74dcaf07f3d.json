{"ast":null,"code":"import { BehaviorSubject, throwError } from \"rxjs\";\nimport { catchError, tap } from \"rxjs/operators\";\nimport { User } from \"./user.model\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.user = new BehaviorSubject(null);\n    this.token = null;\n  }\n  signup(email, password) {\n    return this.http.post('https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA', {\n      email: email,\n      password: password,\n      returnSecureToken: true\n    }).pipe(catchError(this.handleError), tap(resData => {\n      this.handleAuthentication(resData.email, resData.localId, resData.idToken, +resData.expiresIn);\n    }));\n  }\n  login(email, password) {\n    return this.http.post('https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA', {\n      email: email,\n      password: password,\n      returnSecureToken: true\n    }).pipe(catchError(this.handleError), tap(resData => {\n      this.handleAuthentication(resData.email, resData.localId, resData.idToken, +resData.expiresIn);\n    }));\n  }\n  autoLogin() {\n    const userData = JSON.parse(localStorage.getItem('userData'));\n    if (!userData) {\n      return;\n    }\n    const loadedData = new User(userData.email, userData.id, userData._token, new Date(userData._tokenExpirationDate));\n    if (loadedData.token) {\n      this.user.next(loadedData);\n      const expirationDuration = new Date(userData._tokenExpirationDate).getTime() - new Date().getTime();\n      this.autoLogout(expirationDuration);\n    }\n  }\n  logout() {\n    this.user.next(null);\n    this.router.navigate(['/auth']);\n    localStorage.removeItem('userData');\n    if (this.tokenExpirationTimer) {\n      clearTimeout(this.tokenExpirationTimer);\n    }\n  }\n  autoLogout(expirationDuration) {\n    this.tokenExpirationTimer = setTimeout(() => {\n      this.logout();\n    }, expirationDuration);\n  }\n  handleAuthentication(email, userId, token, expiresIn) {\n    const exierationDate = new Date(new Date().getTime() + expiresIn * 1000);\n    const user = new User(email, userId, token, exierationDate);\n    this.user.next(user);\n    this.autoLogout(expiresIn * 1000);\n    localStorage.setItem('userData', JSON.stringify(user));\n  }\n  handleError(errorRes) {\n    let errorMsg = 'An unknown error ocurred!!';\n    if (!errorRes.error || !errorRes.error.error) {\n      console.log('gg');\n      return throwError(errorRes);\n    }\n    switch (errorRes.error.error.message) {\n      case 'EMAIL_EXISTS':\n        errorMsg = 'email already exist!!';\n        break;\n      case 'INVALID_PASSWORD':\n        errorMsg = 'email already exist!!';\n        break;\n      case 'EMAIL_NOT_FOUND':\n        errorMsg = 'email already exist!!';\n        break;\n    }\n    return throwError(errorMsg);\n  }\n}\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n};\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["BehaviorSubject","throwError","catchError","tap","User","AuthService","constructor","http","router","signup","email","password","post","returnSecureToken","pipe","handleError","resData","handleAuthentication","localId","idToken","expiresIn","login","autoLogin","userData","JSON","parse","localStorage","getItem","loadedData","id","_token","Date","_tokenExpirationDate","token","user","next","expirationDuration","getTime","autoLogout","logout","navigate","removeItem","tokenExpirationTimer","clearTimeout","setTimeout","userId","exierationDate","setItem","stringify","errorRes","errorMsg","error","console","log","message","factory","providedIn"],"sourceRoot":"","sources":["/home/bhavika/Documents/bhavika/Angular/Project/src/app/auth/auth.service.ts"],"sourcesContent":["import { HttpClient, HttpErrorResponse } from \"@angular/common/http\";\nimport { Injectable } from \"@angular/core\";\nimport { Router } from \"@angular/router\";\nimport { BehaviorSubject, Subject, throwError } from \"rxjs\";\nimport { catchError, tap } from \"rxjs/operators\";\nimport { User } from \"./user.model\";\n\nexport interface AuthResponseData{\n    idToken : string,\n    email : string,\n    refreshToken : string,\n    expiresIn : string,\n    localId : string,\n    registered? : boolean\n}\n\n@Injectable({\n    providedIn:'root'\n})\nexport class AuthService{\n    user=new BehaviorSubject<User>(null);\n\n    token:string=null;\n    tokenExpirationTimer:any;\n    constructor(private http:HttpClient,private router:Router){}\n\n    signup(email:string,password:string){\n        return this.http.post<AuthResponseData>('https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\n        {\n            email:email,\n            password:password,\n            returnSecureToken:true\n        }\n        ).pipe(catchError(this.handleError),tap(resData=>{\n            this.handleAuthentication(\n                resData.email,\n                resData.localId,\n                resData.idToken,\n                +resData.expiresIn)\n        }));\n    }\n\n    login(email:string,password:string){\n        return  this.http.post<AuthResponseData>('https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\n        {\n            email:email,\n            password:password,\n            returnSecureToken:true\n        }  ).pipe(catchError(this.handleError),tap(resData=>{\n            this.handleAuthentication(\n                resData.email,\n                resData.localId,\n                resData.idToken,\n                +resData.expiresIn)\n        }));\n    }\n\n    autoLogin(){\n        const userData:{\n            email:string,\n            id:string,\n            _token:string,\n            _tokenExpirationDate:string\n        }=JSON.parse(localStorage.getItem('userData'));\n        if(!userData){\n            return;\n        }\n        const loadedData=new User(userData.email,userData.id,userData._token,new Date(userData._tokenExpirationDate));\n        if(loadedData.token){\n            this.user.next(loadedData);\n            const expirationDuration=new Date(userData._tokenExpirationDate).getTime() - new Date().getTime();\n            this.autoLogout(expirationDuration);\n        }\n    }\n\n    logout(){\n        this.user.next(null);\n        this.router.navigate(['/auth']);\n        localStorage.removeItem('userData');\n        if(this.tokenExpirationTimer){\n            clearTimeout(this.tokenExpirationTimer);\n        }\n    }\n\n    autoLogout(expirationDuration){\n        this.tokenExpirationTimer= setTimeout(()=>{\n            this.logout();\n        },expirationDuration);\n    }\n    \n    \n    private handleAuthentication(\n        email:string,\n        userId:string,\n        token:string,\n        expiresIn:number\n        ){\n            const exierationDate=new Date(new Date().getTime() + expiresIn*1000);\n            const user= new User(email, userId, token, exierationDate);\n            this.user.next(user);\n            this.autoLogout(expiresIn*1000);\n            localStorage.setItem('userData',JSON.stringify(user))\n        }\n    private handleError(errorRes:HttpErrorResponse){\n        let errorMsg='An unknown error ocurred!!'\n        if (!errorRes.error || !errorRes.error.error) {\n            console.log('gg');\n            return throwError(errorRes);\n          }\n        switch(errorRes.error.error.message){\n            case 'EMAIL_EXISTS':\n                errorMsg='email already exist!!';\n                break;\n            case 'INVALID_PASSWORD':\n                errorMsg='email already exist!!';\n                break;\n            case 'EMAIL_NOT_FOUND':\n                errorMsg='email already exist!!';\n                break;\n        }\n        return throwError(errorMsg);\n    }\n}\n\n\n\n\n// import { HttpClient, HttpErrorResponse } from \"@angular/common/http\";\n// import { Injectable } from \"@angular/core\";\n// import { catchError, tap } from \"rxjs/operators\";\n// import { BehaviorSubject, throwError } from \"rxjs\";\n// import { User } from \"./user.model\";\n// import { Route, Router } from \"@angular/router\";\n\n// export interface AuthResponseData {\n//     kind: string;\n//     idToken: string;\n//     email: string;\n//     refreshToken: string;\n//     expiresIn: string;\n//     localId: string;\n//     registered?: boolean;\n// }\n\n\n// @Injectable({ \n//     providedIn: 'root' \n// })\n// export class AuthService{\n\n//     user = new BehaviorSubject<User>(null);\n//     token: string = null;\n//     private tokenExpirationTime: any;\n    \n//     constructor(private http: HttpClient, private router: Router){\n//     }\n\n\n//     signup(email: string, password: string ){\n//         return this.http.post<AuthResponseData>(\n//             'https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\n//         {\n//             email: email,\n//             password: password,\n//             returnSecuredToken: true\n\n//         }).pipe(catchError(this.handlError), \n//             tap(resData => {\n//             this.handleAuthentication(\n//                 resData.email, \n//                 resData.localId, \n//                 resData.idToken, \n//                 +resData.expiresIn\n//             )\n//         }));\n//     }\n\n//     login(email: string, password: string){\n//         return this.http.post<AuthResponseData>(\n//             'https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDzLGQj2UYQCx66VgeEe3PkRfacUhrbRmA',\n//             {\n//                 email: email,\n//                 password: password,\n//                 returnSecuredToken: true\n//             }).pipe(catchError(this.handlError), tap(resData => {            \n//                 this.handleAuthentication(resData.email, resData.localId, resData.idToken, +resData.expiresIn)\n//             }));\n//     }\n\n//     autoLogin(){\n//         const userData: {\n//             email : string;\n//             id: string;\n//             _token : string;\n//             _tokenExpirationDate : string;\n//         } = JSON.parse(localStorage.getItem('userData'));\n//         if(!userData){\n//             return;\n//         }\n\n//         const loadedUser = new User(\n//             userData.email, \n//             userData.id, \n//             userData._token,\n//             new Date(userData._tokenExpirationDate)\n//         );\n    \n//         if(loadedUser.token){\n//             this.user.next(loadedUser);\n//             const expirationDate = new Date(userData._tokenExpirationDate).getTime() - new Date().getTime();\n//             this.autoLogout(expirationDate);\n//             console.log(expirationDate);\n//         }\n//     }\n\n//     logout(){\n//         this.user.next(null);\n//         this.router.navigate(['./auth']);\n//         localStorage.removeItem('userData');\n//         if(this.tokenExpirationTime){\n//             clearTimeout(this.tokenExpirationTime);\n//         }\n//         this.tokenExpirationTime = null;\n//     }\n\n//     autoLogout(expirationDuration: number){\n//         console.log(expirationDuration);\n      \n//         setTimeout(()=>{   \n//             this.logout();\n//         }, 7000000);\n//     }\n\n//     private handleAuthentication(email: string,userId: string, token: string, expiresIn: number){\n//         const expirationDate = new Date(new Date().getTime()+ (expiresIn*1000));\n//         const user = new User(email, userId, token, expirationDate)\n//         this.user.next(user);\n//         this.autoLogout(expiresIn * 1000);\n//         localStorage.setItem('userData', JSON.stringify(user))\n    \n//     }\n\n//     private handlError(errorRes: HttpErrorResponse){\n        \n//         let errorMsg = \"An Unknown error has been occured\"\n//         console.log(errorRes.error.error);\n        \n//         // errorRes.error && errorRes.error.error\n//         if(!errorRes.error || !errorRes.error.error){\n//             return throwError(errorMsg);\n//         }\n        \n//         switch( errorRes.error.error.message){\n//             case 'EMAIL_EXISTS': errorMsg = \"An Email Exists Already\";\n//                                 break;\n//             case 'EMAIL_NOT_FOUND': errorMsg = \"This Email does not Exist\";\n//             break;\n//             case 'INVALID_PASSWORD': errorMsg = \"Password is Incorrect\";\n//             break;\n        \n//         }\n//         return throwError(errorMsg);       \n//     }\n// }"]},"metadata":{},"sourceType":"module","externalDependencies":[]}